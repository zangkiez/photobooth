<?php

namespace Photobooth\Configuration\Section;

use Symfony\Component\Config\Definition\Builder\NodeDefinition;
use Symfony\Component\Config\Definition\Builder\TreeBuilder;

final class PictureConfiguration
{
    public static function getNode(): NodeDefinition
    {
        return (new TreeBuilder('picture'))->getRootNode()->addDefaultsIfNotSet()
            ->ignoreExtraKeys()
            ->children()
                ->scalarNode('key')
                    ->info('specify key id (e.g. 13 is the enter key) to use that key to reload the page, use for example https://keycode.info to get the key code')
                    ->defaultValue('')
                    ->end()
                ->enumNode('thumb_size')
                    ->values(['360px', '540px', '900px', '1080px', '1260px'])
                    ->defaultValue('540px')
                    ->end()
                ->integerNode('time_to_live')
                    ->defaultValue(90)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->booleanNode('preview_before_processing')->defaultValue(false)->end()
                ->integerNode('retry_on_error')
                    ->defaultValue(0)
                    ->min(0)
                    ->max(10)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->integerNode('retry_timeout')
                    ->defaultValue(2)
                    ->min(0)
                    ->max(10)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->booleanNode('enabled')->defaultValue(true)->end()
                ->integerNode('cntdwn_time')
                    ->defaultValue(5)
                    ->min(0)
                    ->max(10)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->integerNode('cheese_time')
                    ->defaultValue(1000)
                    ->min(0)
                    ->max(10000)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->enumNode('flip')
                    ->values(['off', 'flip-horizontal', 'flip-vertical', 'flip-both'])
                    ->defaultValue('off')
                    ->end()
                ->integerNode('rotation')
                    ->defaultValue(0)
                    ->min(0)
                    ->max(359)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->booleanNode('polaroid_effect')->defaultValue(false)->end()
                ->integerNode('polaroid_rotation')
                    ->defaultValue(0)
                    ->min(-359)
                    ->max(359)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->booleanNode('take_frame')->defaultValue(true)->end()
                ->scalarNode('frame')->defaultValue('')->end()
                ->booleanNode('extend_by_frame')->defaultValue(true)->end()
                ->integerNode('frame_left_percentage')
                    ->defaultValue(10)
                    ->min(0)
                    ->max(100)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->integerNode('frame_right_percentage')
                    ->defaultValue(10)
                    ->min(0)
                    ->max(100)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->integerNode('frame_top_percentage')
                    ->defaultValue(5)
                    ->min(0)
                    ->max(100)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->integerNode('frame_bottom_percentage')
                    ->defaultValue(15)
                    ->min(0)
                    ->max(100)
                    ->beforeNormalization()
                        ->ifString()
                        ->then(function (string $value): int { return intval($value); })
                        ->end()
                    ->end()
                ->enumNode('naming')
                    ->values(['dateformatted', 'random'])
                    ->defaultValue('dateformatted')
                    ->end()
                ->scalarNode('permissions')
                    ->info('0644 (rw-r--r--), 0666 (rw-rw-rw-), 0600 (rw-------)')
                    ->defaultValue('0644')
                    ->end()
                ->booleanNode('keep_original')->defaultValue(true)->end()
                ->booleanNode('preserve_exif_data')->defaultValue(false)->end()
                ->booleanNode('allow_delete')->defaultValue(true)->end()
            ->end();
    }
}
